variables:
  JOB_CPUS: "20"
  JOB_TMPFS: "8G"
  JOB_MEMORY: "80G"
  JOB_CHUNKS: "1"
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - build_intel
  - run_configs_intel
  - build_gnu
  - run_configs_gnu

before_script:
    - export CLICOLOR_FORCE=1

build_intel:
  stage: build_intel
  script:
    - ln -s $HOME/gem_dbase .
    - . ./.eccc_setup_intel
    - . ./.eccc_initial_setup
    - make cmake
    - make -j`nproc`
    - make -j`nproc` work
  artifacts:
    paths:
    - work*
    - gem_dbase
  only:
  - dev-cmake_rpn

5.2GEM_GY_FISL_H_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/5.2GEM_cfgs_GY_FISL_H
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/5.2GEM_cfgs_GY_FISL_H -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

CANO_W7cascP_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_W7cascP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_W7cascP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

CANO_dcmip163r100_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_dcmip163r100
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_dcmip163r100 -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

CANO_wil7_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_wil7
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_wil7 -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

GEM_GY_FISL_P_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_GY_FISL_P
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_GY_FISL_P -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

GEM_LU_FISL_H_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_LU_FISL_H
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_LU_FISL_H -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

GEM_LU_OFFC_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_LU_OFFC
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_LU_OFFC -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

PTOPO_GYH_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/PTOPO_cfgs_GYH
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/PTOPO_cfgs_GYH -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

PTOPO_LUP_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/PTOPO_cfgs_LUP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/PTOPO_cfgs_LUP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

RSTRT_GYP_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/RSTRT_cfgs_GYP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/RSTRT_cfgs_GYP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

THEO_bubbleG_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/THEO_cfgs_bubbleG
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/THEO_cfgs_bubbleG -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

THEO_schar_intel:
  stage: run_configs_intel
  script:
    - . ./.eccc_setup_intel
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/THEO_cfgs_schar
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/THEO_cfgs_schar -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn

build_gnu:
  stage: build_gnu
  script:
    - . ./.eccc_setup_gnu
    - . ./.eccc_initial_setup
    - make cmake
    - make -j`nproc`
    - make -j`nproc` work
  artifacts:
    paths:
    - work*
    - gem_dbase
  only:
  - dev-cmake_rpn
  when: always

5.2GEM_GY_FISL_H_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/5.2GEM_cfgs_GY_FISL_H
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/5.2GEM_cfgs_GY_FISL_H -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

CANO_W7cascP_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_W7cascP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_W7cascP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

CANO_dcmip163r100_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_dcmip163r100
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_dcmip163r100 -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

CANO_wil7_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/CANO_cfgs_wil7
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/CANO_cfgs_wil7 -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

GEM_GY_FISL_P_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_GY_FISL_P
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_GY_FISL_P -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

GEM_LU_FISL_H_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_LU_FISL_H
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_LU_FISL_H -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

GEM_LU_OFFC_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/GEM_cfgs_LU_OFFC
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/GEM_cfgs_LU_OFFC -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

PTOPO_GYH_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/PTOPO_cfgs_GYH
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/PTOPO_cfgs_GYH -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

PTOPO_LUP_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/PTOPO_cfgs_LUP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/PTOPO_cfgs_LUP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

RSTRT_GYP_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/RSTRT_cfgs_GYP
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/RSTRT_cfgs_GYP -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

THEO_bubbleG_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/THEO_cfgs_bubbleG
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/THEO_cfgs_bubbleG -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always

THEO_schar_gnu:
  stage: run_configs_gnu
  script:
    - . ./.eccc_setup_gnu
    - cd $GEM_WORK
    - _status=ABORT
    - . r.call.dot runprep.sh -dircfg ./configurations/THEO_cfgs_schar
    - if [ "${_status}" == "ED" ]; then
      _status=ABORT;
      . r.call.dot runmod.sh -dircfg ./configurations/THEO_cfgs_schar -ptopo $GEMTEST_ptopo;
      fi
    - test "${_status}" == "ED"
  only:
  - dev-cmake_rpn
  when: always
